<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="utf-8">
	<title>Glossop Camera Club</title>
	<meta name="description" content="">
	<meta name="author" content="">
	
	<meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0;  user-scalable=0;" name="viewport">
	<link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="css/normalize.css">
	<link rel="stylesheet" href="css/skeleton.css">
	<link rel="stylesheet" href="css/flickr.css">
	<link rel="icon" type="image/png" href="images/favicon.png">
	<link rel="stylesheet" href="style/main.css">
	<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>

	<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script src="js/flickr.js"></script>
	<script language ="javascript" >
		$(document).ready(function(){
		   loadPhotos();
		   loadTopicsDropDown();
		   getPhotosWithTags();   
			$("#popup").hide();
		});
		
		var allPhotos = [];
		
		function loadPhotos(){		

			//Glossop Camera Club Account
			//var url = "https://api.flickr.com/services/rest/?per_page=20&format=json&method=flickr.photos.search&user_id=139185935@N04&sort=date-taken-desc&api_key=b9b545d8e702dd0aaefe231a06b1ce46&tags=" + tags;
			var url = "https://api.flickr.com/services/rest/?per_page=500&format=json&method=flickr.photos.search&user_id=139185935@N04&sort=date-taken-desc&api_key=b9b545d8e702dd0aaefe231a06b1ce46&extras=tags";
			callURL(url, allPhotos, function (x) {  });
			
			//Glossop Camera Club Group
			var url2 = "https://api.flickr.com/services/rest/?per_page=500&format=json&method=flickr.photos.search&group_id=1959874@N20&sort=date-taken-desc&api_key=b9b545d8e702dd0aaefe231a06b1ce46&tag_mode=all&tags=p52&extras=tags";
			callURL(url2, allPhotos, function (x) {  });					
		}
		
		function getPhotos(tags){
			var topicid = $('#topics option:selected').val();
			var tagArr = [];
			$.each(allPhotos, function(i,item){			
				
				//var tags = item.tags;
				var photoTags = item.tags.toLowerCase();

				var found = 1;
				var x;
				for (x in tags) {
				    if (photoTags.indexOf(tags[x]) == -1){
					found = 0;
				    }
				}
				
				if (found){
					//tagArr.push.apply(tagArr, item);
					tagArr.push(item);
				}				
			});
			
			console.log(allPhotos.length);
			//console.log('test');
			
			renderHTML(tagArr);
		}
		
		function getPhotosWithTags(){
			var tags = $('#topics :selected').text().toLowerCase();			 
			tags = tags.replace(" & ", ","); 
			tags = tags.replace(" of ", ","); 
			tags = tags.replace("-", ","); 
			tags = tags.replace(" ", ",");
			//console.log(tags);
			getPhotos(tags.split(","));
		}
		
		function loadTopicsDropDown(){
			var topics =  ["Time", "Your Everyday", "Out of Focus", "Shadows", "Morning", "Unbalanced", "Love", "Outtake", "Black & White", "Self-Portrait", "Texture", "Silhouette", "Technology", "Hidden", "Far Away", "Water", "Framed", "Sky", "Laughter", "Nature", "Family", "Light", "Movement", "Below", "Food", "Haze", "Patriotic", "Animal", "Long Exposure", "Colourful", "Music", "Soft", "Hot", "Structure", "Bokeh", "Pattern", "Remember", "Above", "Negative Space", "Reflection", "Button", "Fall", "Together", "Disguise", "Macro", "Chaos", "Thankful", "Hobby", "Cold", "Sleep", "Details", "Joy"];
			
			for(var i = 0; i < topics.length; i++) {
			    //Do things with things[i]
			    //$( "#topics" ).append($('<option>' + topics[i] + '</option>'));
			    $('#topics').append($('<option>', {
				    value: i,
				    text: topics[i]
				}));
			}
			
			var week = getWeekOfYear();
			$('#topics option')[week-1].selected = true;
		}

	</script>
</head>
<body>

  <div class="container">
	<div id="banner">
		<img class="bannerimg" src="images/gcc_header.jpg" />
	</div>
	<div class="menuholder">
		<ul id="nav">
			<li><a href="index.html">Club</a></li>
			<li><a href="meetings.html">Meetings</a></li>
			<li><a href="gallery.html">Gallery</a></li>
			<li><a href="project52.html">Project 52</a></li>
			
			<li class="social"><a href="https://www.facebook.com/groups/Glossopcameraclub/" target="_blank"><img src="images/facebook.png" width="30px" height="30px" /></a></li>
			<li class="social"><a href="https://twitter.com/GlsspCameraClub" target="_blank"><img src="images/twitter.png" width="30px" height="30px" /></a></li>
			<li class="social"><a href="https://www.flickr.com/groups/1959874@N20/" target="_blank"><img src="images/flickr.png" width="30px" height="30px" /></a></li>
		</ul>		
	</div>
	<div class="rule"></div>
    <div class="row">
      <div class="one-half column" style="margin-top: 5%">
        <h4>Glossop Camera Club</h4>
	<p></p>        
      </div>      
    </div>
    <div>
		<select id="topics" onchange="javascript:getPhotosWithTags();"></select>
		<br />		
		<div id="gallery">
		</div>
		
		<div  id="popup">
		    <!--a href="javascript:closePopUp();" class="close">X</a-->
		    <a id="flickrlink" target="_blank"><img class="popphoto" /><span style="display: block" class="desc" /></a>
		</div>
		<div id="loading">Loading...</div>
      </div>
  </div>
</body>
</html>
